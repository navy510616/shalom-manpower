<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>Shalom Manpower</title>
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/summary.css" />
    <link rel="stylesheet" href="css/invoice.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>

    <!-- Firebase ì¸ì¦ ê²€ì‚¬ -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
      import {
        getAuth,
        onAuthStateChanged,
      } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";

      const firebaseConfig = {
        apiKey: "AIzaSyBzkoyKiSBrhC-leS0FeVCnHQzAUBtOYBw",
        authDomain: "shalom-manpower.firebaseapp.com",
        projectId: "shalom-manpower",
        storageBucket: "shalom-manpower.firebasestorage.app",
        messagingSenderId: "554580073535",
        appId: "1:554580073535:web:49899724ce3dd926c22c8a",
        measurementId: "G-NT2CFFLQLR",
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);

      onAuthStateChanged(auth, (user) => {
        if (!user) {
          window.location.href = "login.html";
        }
      });

      // ğŸ‘‰ ì°½ ë‹«ì„ ë•Œë§Œ ë¡œê·¸ì•„ì›ƒ, ìƒˆë¡œê³ ì¹¨ì€ ì œì™¸
      window.addEventListener('beforeunload', async (event) => {
        const entries = performance.getEntriesByType('navigation');
        const navType = entries.length > 0 ? entries[0].type : '';

        if (navType !== 'reload') {  // ìƒˆë¡œê³ ì¹¨ì´ ì•„ë‹ˆë¼ë©´ (= ì°½ ë‹«ê¸°)
          try {
            await signOut(auth);
            console.log("âœ… ì°½ ë‹«ê¸° ê°ì§€ â†’ ìë™ ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ");
          } catch (error) {
            console.error("âŒ ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨:", error);
          }
        } else {
          console.log("ğŸ”„ ìƒˆë¡œê³ ì¹¨ ê°ì§€ â†’ ë¡œê·¸ì•„ì›ƒ ì•ˆ í•¨");
        }
      });
      
    </script>
  </head>

  <body>
    <div class="layout">
      <div class="sidebar">
        <h2>Menu</h2>
        <a href="#" onclick="navigate('monthly')">ì›”ë³„ ê´€ë¦¬</a>
        <a href="#" onclick="navigate('schedule')">ì›”ë§ ì •ë¦¬</a>
        <a href="#" onclick="navigate('invoice')">ê±°ë˜ëª…ì„¸ì„œ</a>
        <a href="#" onclick="logout()">ğŸ”“ ë¡œê·¸ì•„ì›ƒ</a>
        <!-- <div class="resizer">â‹®â‹®</div> -->
      </div>
      <div class="main-content" id="page-container">
        <!-- ë™ì ìœ¼ë¡œ ì½˜í…ì¸  ì‚½ì… -->
      </div>
    </div>
    <!-- âœ… Firebase ë¡œê·¸ì•„ì›ƒ ë¡œì§ -->
    <script type="module">
      import {
        getAuth,
        signOut,
      } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";
      const auth = getAuth();

      window.logout = function () {

        // âœ… ë¡œê·¸ì¸ ì„¸ì…˜ ì§€ìš°ê¸°
        sessionStorage.removeItem('isLoggedIn');

        // âœ… Firebase ì¸ì¦ ë¡œê·¸ì•„ì›ƒ
        signOut(auth).then(() => {
          window.location.href = "login.html";
        }).catch((error) => {
          console.error('âŒ ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨:', error);
        });
      };
    </script>
    <script src="js/main.js"></script>
  </body>
</html>
